<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Demo - Ezchain Blockchain</title>
    <link rel="stylesheet" href="static/css/style.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <h2>Ezchain</h2>
            </div>
            <ul class="nav-menu">
                <li><a href="index.html" class="nav-link">Home</a></li>
                <li><a href="features.html" class="nav-link">Features</a></li>
                <li><a href="architecture.html" class="nav-link">Architecture</a></li>
                <li><a href="demo.html" class="nav-link">Demo</a></li>
                <li><a href="documentation.html" class="nav-link">Documentation</a></li>
                <li><a href="about.html" class="nav-link">About</a></li>
                <li><a href="https://github.com/Re20Cboy/Ezchain-py" target="_blank" class="nav-link"><i class="fab fa-github"></i></a></li>
            </ul>
            <div class="nav-toggle">
                <i class="fas fa-bars"></i>
            </div>
        </div>
    </nav>

    <main>
        <div class="page-header">
            <div class="container">
                <h1>Live Demo</h1>
                <p>Experience Ezchain's blockchain capabilities in real-time</p>
            </div>
        </div>

        <section class="demo-overview">
            <div class="container">
                <div class="demo-intro">
                    <h2>Interactive Blockchain Demo</h2>
                    <p>
                        Welcome to the Ezchain live demonstration! This interactive demo showcases the core 
                        features of our revolutionary blockchain system. You can observe real-time mining, 
                        create transactions, and explore the blockchain's structure.
                    </p>
                    <div class="demo-controls">
                        <button class="btn btn-success" onclick="initBlockchain()">
                            <i class="fas fa-play"></i> Initialize Blockchain
                        </button>
                        <button class="btn btn-primary" onclick="startMining()" id="startMiningBtn">
                            <i class="fas fa-hammer"></i> Start Mining
                        </button>
                        <button class="btn btn-danger" onclick="stopMining()" id="stopMiningBtn" disabled>
                            <i class="fas fa-stop"></i> Stop Mining
                        </button>
                        <button class="btn btn-warning" onclick="resetBlockchain()">
                            <i class="fas fa-redo"></i> Reset
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <section class="demo-stats">
            <div class="container">
                <h2 class="section-title">Network Statistics</h2>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-cubes"></i>
                        </div>
                        <div class="stat-number" id="totalBlocks">0</div>
                        <div class="stat-label">Total Blocks</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-exchange-alt"></i>
                        </div>
                        <div class="stat-number" id="totalTransactions">0</div>
                        <div class="stat-label">Transactions</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-tachometer-alt"></i>
                        </div>
                        <div class="stat-number" id="miningSpeed">0</div>
                        <div class="stat-label">Mining Speed</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-network-wired"></i>
                        </div>
                        <div class="stat-number" id="nodeCount">0</div>
                        <div class="stat-label">Active Nodes</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-number" id="accountCount">0</div>
                        <div class="stat-label">Accounts</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="stat-number" id="currentRound">0</div>
                        <div class="stat-label">Current Round</div>
                    </div>
                </div>
            </div>
        </section>

        <section class="demo-transactions">
            <div class="container">
                <h2 class="section-title">Create Transaction</h2>
                <div class="transaction-form">
                    <div class="form-group">
                        <label for="senderId">Sender Account ID:</label>
                        <select class="form-control" id="senderId">
                            <option value="">Select sender...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="recipientId">Recipient Account ID:</label>
                        <select class="form-control" id="recipientId">
                            <option value="">Select recipient...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="amount">Amount:</label>
                        <input type="number" class="form-control" id="amount" min="1" value="10">
                    </div>
                    <button class="btn btn-primary" onclick="createTransaction()">
                        <i class="fas fa-paper-plane"></i> Create Transaction
                    </button>
                </div>
            </div>
        </section>

        <section class="demo-blocks">
            <div class="container">
                <h2 class="section-title">Recent Blocks</h2>
                <div class="blocks-container">
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>Index</th>
                                    <th>Hash</th>
                                    <th>Miner</th>
                                    <th>Time</th>
                                    <th>Nonce</th>
                                    <th>Transactions</th>
                                </tr>
                            </thead>
                            <tbody id="blocksTable">
                                <tr>
                                    <td colspan="6" class="text-center">No blocks yet. Initialize the blockchain to start mining.</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>

        <section class="demo-transactions-list">
            <div class="container">
                <h2 class="section-title">Recent Transactions</h2>
                <div class="transactions-container">
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>Transaction ID</th>
                                    <th>Sender</th>
                                    <th>Recipient</th>
                                    <th>Amount</th>
                                    <th>Time</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="transactionsTable">
                                <tr>
                                    <td colspan="6" class="text-center">No transactions yet.</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>

        <section class="demo-nodes">
            <div class="container">
                <h2 class="section-title">Network Nodes</h2>
                <div class="nodes-grid">
                    <div id="nodesList">
                        <div class="text-center">
                            <p>No nodes available. Initialize the blockchain to create nodes.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Mining Status Modal -->
        <div class="modal" id="miningModal">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h4 class="modal-title">Mining Status</h4>
                        <button type="button" class="close" onclick="closeMiningModal()">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div class="text-center">
                            <div class="spinner-border" role="status">
                                <span class="sr-only">Mining...</span>
                            </div>
                            <p>Mining in progress...</p>
                            <p>Round: <span id="modalCurrentRound">0</span></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Alert Container -->
        <div id="alertContainer"></div>
    </main>

    <footer class="footer">
        <div class="footer-container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>Ezchain</h3>
                    <p>A decentralized scale-out blockchain ledger system for Web3.0</p>
                </div>
                <div class="footer-section">
                    <h3>Quick Links</h3>
                    <ul>
                        <li><a href="index.html">Home</a></li>
                        <li><a href="features.html">Features</a></li>
                        <li><a href="architecture.html">Architecture</a></li>
                        <li><a href="documentation.html">Documentation</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h3>Resources</h3>
                    <ul>
                        <li><a href="https://github.com/Re20Cboy/Ezchain-py" target="_blank">GitHub Repository</a></li>
                        <li><a href="https://arxiv.org/abs/2312.00281" target="_blank">arXiv Paper</a></li>
                        <li><a href="demo.html">Live Demo</a></li>
                        <li><a href="documentation.html">API Documentation</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2024 Ezchain. All rights reserved. | Open source project under MIT License</p>
            </div>
        </div>
    </footer>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Demo JavaScript for blockchain interaction
        let blockchainInitialized = false;
        let miningInProgress = false;
        let updateInterval;

        // Simulated blockchain data
        let demoData = {
            blocks: [],
            transactions: [],
            nodes: [],
            accounts: [],
            currentRound: 0
        };

        function showAlert(message, type = 'info') {
            const alertContainer = document.getElementById('alertContainer');
            const alert = document.createElement('div');
            alert.className = `alert alert-${type} alert-dismissible fade show`;
            alert.innerHTML = `
                ${message}
                <button type="button" class="close" onclick="this.parentElement.remove()">&times;</button>
            `;
            alertContainer.appendChild(alert);
            
            setTimeout(() => {
                if (alert.parentElement) {
                    alert.remove();
                }
            }, 5000);
        }

        function initBlockchain() {
            if (blockchainInitialized) {
                showAlert('Blockchain already initialized!', 'warning');
                return;
            }

            // Simulate blockchain initialization
            demoData.blocks = [{
                index: 0,
                hash: 'genesis_hash',
                pre_hash: '0',
                miner: 'genesis',
                time: new Date().toISOString(),
                nonce: 0,
                m_tree_root: 'genesis_root',
                bloom_size: 0,
                signature: 'genesis_signature'
            }];

            // Create demo accounts
            demoData.accounts = [];
            for (let i = 0; i < 5; i++) {
                demoData.accounts.push({
                    id: i,
                    address: `account_${i}`,
                    balance: Math.floor(Math.random() * 1000) + 100
                });
            }

            // Create demo nodes
            demoData.nodes = [];
            for (let i = 0; i < 5; i++) {
                demoData.nodes.push({
                    id: i,
                    address: `node_${i}`,
                    neighbor_count: Math.floor(Math.random() * 4) + 1,
                    block_count: 1,
                    public_key: `public_key_${i.substring(0, 20)}...`
                });
            }

            blockchainInitialized = true;
            updateUI();
            showAlert('Blockchain initialized successfully!', 'success');
            updateAccountSelectors();
        }

        function startMining() {
            if (!blockchainInitialized) {
                showAlert('Please initialize the blockchain first!', 'warning');
                return;
            }

            if (miningInProgress) {
                showAlert('Mining already in progress!', 'warning');
                return;
            }

            miningInProgress = true;
            document.getElementById('startMiningBtn').disabled = true;
            document.getElementById('stopMiningBtn').disabled = false;
            
            showAlert('Mining started!', 'success');
            
            // Start mining simulation
            updateInterval = setInterval(() => {
                if (miningInProgress) {
                    mineBlock();
                }
            }, 3000);
        }

        function stopMining() {
            if (!miningInProgress) {
                showAlert('Mining not in progress!', 'warning');
                return;
            }

            miningInProgress = false;
            document.getElementById('startMiningBtn').disabled = false;
            document.getElementById('stopMiningBtn').disabled = true;
            
            if (updateInterval) {
                clearInterval(updateInterval);
            }
            
            showAlert('Mining stopped!', 'info');
        }

        function mineBlock() {
            const newBlock = {
                index: demoData.blocks.length,
                hash: `block_${demoData.blocks.length}_${Math.random().toString(36).substring(7)}`,
                pre_hash: demoData.blocks[demoData.blocks.length - 1].hash,
                miner: `node_${Math.floor(Math.random() * 5)}`,
                time: new Date().toISOString(),
                nonce: Math.floor(Math.random() * 1000000),
                m_tree_root: `root_${Math.random().toString(36).substring(7)}`,
                bloom_size: Math.floor(Math.random() * 10) + 1,
                signature: `sig_${Math.random().toString(36).substring(7)}`
            };

            demoData.blocks.push(newBlock);
            demoData.currentRound++;
            
            // Add some random transactions
            if (Math.random() > 0.5 && demoData.accounts.length >= 2) {
                const sender = demoData.accounts[Math.floor(Math.random() * demoData.accounts.length)];
                const recipient = demoData.accounts[Math.floor(Math.random() * demoData.accounts.length)];
                
                if (sender.id !== recipient.id && sender.balance > 10) {
                    const amount = Math.floor(Math.random() * 50) + 1;
                    const transaction = {
                        id: `tx_${demoData.transactions.length}`,
                        sender: sender.address,
                        recipient: recipient.address,
                        amount: amount,
                        timestamp: new Date().toISOString(),
                        status: 'confirmed'
                    };
                    
                    demoData.transactions.unshift(transaction);
                    sender.balance -= amount;
                    recipient.balance += amount;
                }
            }

            updateUI();
        }

        function createTransaction() {
            if (!blockchainInitialized) {
                showAlert('Please initialize the blockchain first!', 'warning');
                return;
            }

            const senderId = document.getElementById('senderId').value;
            const recipientId = document.getElementById('recipientId').value;
            const amount = parseInt(document.getElementById('amount').value);

            if (!senderId || !recipientId) {
                showAlert('Please select both sender and recipient!', 'warning');
                return;
            }

            if (senderId === recipientId) {
                showAlert('Sender and recipient must be different!', 'warning');
                return;
            }

            const sender = demoData.accounts[senderId];
            const recipient = demoData.accounts[recipientId];

            if (sender.balance < amount) {
                showAlert('Insufficient balance!', 'danger');
                return;
            }

            const transaction = {
                id: `tx_${demoData.transactions.length}`,
                sender: sender.address,
                recipient: recipient.address,
                amount: amount,
                timestamp: new Date().toISOString(),
                status: 'pending'
            };

            demoData.transactions.unshift(transaction);
            sender.balance -= amount;
            recipient.balance += amount;

            updateUI();
            showAlert('Transaction created successfully!', 'success');
        }

        function resetBlockchain() {
            if (miningInProgress) {
                stopMining();
            }

            demoData = {
                blocks: [],
                transactions: [],
                nodes: [],
                accounts: [],
                currentRound: 0
            };

            blockchainInitialized = false;
            miningInProgress = false;
            
            document.getElementById('startMiningBtn').disabled = false;
            document.getElementById('stopMiningBtn').disabled = true;

            updateUI();
            showAlert('Blockchain reset successfully!', 'info');
        }

        function updateUI() {
            // Update stats
            document.getElementById('totalBlocks').textContent = demoData.blocks.length;
            document.getElementById('totalTransactions').textContent = demoData.transactions.length;
            document.getElementById('miningSpeed').textContent = miningInProgress ? '1.2' : '0';
            document.getElementById('nodeCount').textContent = demoData.nodes.length;
            document.getElementById('accountCount').textContent = demoData.accounts.length;
            document.getElementById('currentRound').textContent = demoData.currentRound;

            // Update blocks table
            const blocksTable = document.getElementById('blocksTable');
            if (demoData.blocks.length === 0) {
                blocksTable.innerHTML = '<tr><td colspan="6" class="text-center">No blocks yet. Initialize the blockchain to start mining.</td></tr>';
            } else {
                blocksTable.innerHTML = demoData.blocks.slice(-10).reverse().map(block => `
                    <tr>
                        <td>${block.index}</td>
                        <td>${block.hash.substring(0, 10)}...</td>
                        <td>${block.miner}</td>
                        <td>${new Date(block.time).toLocaleTimeString()}</td>
                        <td>${block.nonce}</td>
                        <td>${block.bloom_size}</td>
                    </tr>
                `).join('');
            }

            // Update transactions table
            const transactionsTable = document.getElementById('transactionsTable');
            if (demoData.transactions.length === 0) {
                transactionsTable.innerHTML = '<tr><td colspan="6" class="text-center">No transactions yet.</td></tr>';
            } else {
                transactionsTable.innerHTML = demoData.transactions.slice(-10).map(tx => `
                    <tr>
                        <td>${tx.id.substring(0, 10)}...</td>
                        <td>${tx.sender}</td>
                        <td>${tx.recipient}</td>
                        <td>${tx.amount}</td>
                        <td>${new Date(tx.timestamp).toLocaleTimeString()}</td>
                        <td><span class="badge badge-${tx.status === 'confirmed' ? 'success' : 'warning'}">${tx.status}</span></td>
                    </tr>
                `).join('');
            }

            // Update nodes list
            const nodesList = document.getElementById('nodesList');
            if (demoData.nodes.length === 0) {
                nodesList.innerHTML = '<div class="text-center"><p>No nodes available. Initialize the blockchain to create nodes.</p></div>';
            } else {
                nodesList.innerHTML = demoData.nodes.map(node => `
                    <div class="node-card">
                        <div class="node-icon">
                            <i class="fas fa-server"></i>
                        </div>
                        <h3>Node ${node.id}</h3>
                        <p><strong>Address:</strong> ${node.address}</p>
                        <p><strong>Neighbors:</strong> ${node.neighbor_count}</p>
                        <p><strong>Blocks:</strong> ${node.block_count}</p>
                        <p><strong>Public Key:</strong> ${node.public_key}</p>
                    </div>
                `).join('');
            }
        }

        function updateAccountSelectors() {
            const senderSelect = document.getElementById('senderId');
            const recipientSelect = document.getElementById('recipientId');

            senderSelect.innerHTML = '<option value="">Select sender...</option>';
            recipientSelect.innerHTML = '<option value="">Select recipient...</option>';

            demoData.accounts.forEach((account, index) => {
                senderSelect.innerHTML += `<option value="${index}">Account ${index} (Balance: ${account.balance})</option>`;
                recipientSelect.innerHTML += `<option value="${index}">Account ${index} (Balance: ${account.balance})</option>`;
            });
        }

        function closeMiningModal() {
            document.getElementById('miningModal').classList.remove('show');
        }

        // Initialize UI on page load
        document.addEventListener('DOMContentLoaded', function() {
            updateUI();
        });
    </script>
    <script src="static/js/script.js"></script>
</body>
</html>